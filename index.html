<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plansza Drogowa - Magnetyczny System Edukacyjny</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@800&display=swap" rel="stylesheet">
    <style>
        /* ... (pozostaw cały istniejący CSS bez zmian) ... */
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <!-- ... (pozostaw header bez zmian) ... -->
    </header>

    <!-- Hero Section (zmodyfikowane) -->
    <section class="hero" id="home">
        <div class="container hero-content">
            <div class="hero-text fade-in">
                <h2>Magnetyczna Plansza Drogowa</h2>
                <p>Rewolucyjny system edukacyjny do nauki zasad ruchu drogowego poprzez zabawę. Łącz moduły magnetycznie i twórz własne układy dróg!</p>
                <button class="cta-btn">Zobacz zestawy</button>
            </div>
            <div class="hero-image fade-in">
                <img data-sheet-id="hero" src="" alt="Magnetyczna plansza drogowa" style="max-width: 100%; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.3);">
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features">
        <!-- ... (pozostaw bez zmian) ... -->
    </section>

    <!-- Applications Section (zmodyfikowane) -->
    <section class="applications" id="applications">
        <div class="container">
            <div class="section-header fade-in">
                <h2>Zastosowania planszy</h2>
                <p>Sprawdź gdzie możesz wykorzystać nasz system edukacyjny</p>
            </div>
            <div class="applications-grid">
                <div class="application-card fade-in">
                    <div class="application-image">
                        <img data-sheet-id="aplikacja1" src="" alt="Dla dzieci">
                    </div>
                    <div class="application-content">
                        <h3>Dla dzieci</h3>
                        <p>Świetna zabawa z resorakami połączona z nauką zasad ruchu drogowego</p>
                    </div>
                </div>
                <div class="application-card fade-in">
                    <div class="application-image">
                        <img data-sheet-id="aplikacja2" src="" alt="OSK">
                    </div>
                    <div class="application-content">
                        <h3>Dla OSK</h3>
                        <p>Pomoc dydaktyczna dla ośrodków szkolenia kierowców</p>
                    </div>
                </div>
                <!-- ... (pozostałe karty aplikacji z data-sheet-id) ... -->
            </div>
        </div>
    </section>

    <!-- Products Section (zmodyfikowane) -->
    <section class="products" id="products">
        <div class="container">
            <div class="section-header fade-in">
                <h2>Nasze produkty</h2>
                <p>Wybierz zestaw dopasowany do Twoich potrzeb</p>
            </div>
            <div class="products-grid">
                <div class="product-card fade-in">
                    <div class="product-image">
                        <img data-sheet-id="produkt1" src="" alt="Zestaw startowy Plansza Drogowa">
                        <div class="product-badge">BESTSELLER</div>
                    </div>
                    <!-- ... (reszta karty produktu) ... -->
                </div>
                <!-- ... (pozostałe produkty z data-sheet-id) ... -->
            </div>
        </div>
    </section>

    <!-- Construction Section (zmodyfikowane) -->
    <section class="construction" id="construction">
        <div class="container construction-container">
            <div class="construction-image fade-in">
                <img data-sheet-id="konstrukcja" src="" alt="Konstrukcja planszy drogowej">
            </div>
            <!-- ... (reszta sekcji) ... -->
        </div>
    </section>

    <!-- Footer -->
    <footer id="contact">
        <!-- ... (pozostaw footer bez zmian) ... -->
    </footer>

    <!-- Skrypt integracji z Google Sheets -->
    <script>
    // Konfiguracja
    const CONFIG = {
      SHEET_ID: '1cNRrDaz5rxEt4jLl_q-UV1Hnfyp2lwSsd0To9h0a23A',
      SHEET_NAME: 'Arkusz1',
      UPDATE_INTERVAL: 300000, // 5 minut
      FALLBACK_IMAGE: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNlZWVlZWUiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOTk5Ij5BZHJlcyB6ZCVDNCU5OWNpYSBuaWVkZW4gdHljaCB3Y3p5dGFuaWE8L3RleHQ+PC9zdmc+',
      THROTTLE_TIME: 1000
    };

    // Cache dla ochrony przed częstymi requestami
    let lastUpdateTime = 0;
    const imageCache = new Map();

    async function fetchSheetData() {
      try {
        const now = Date.now();
        if (now - lastUpdateTime < CONFIG.THROTTLE_TIME) {
          console.warn('Throttle: Zbyt częste zapytania');
          return null;
        }
        
        lastUpdateTime = now;
        const url = https://docs.google.com/spreadsheets/d/${CONFIG.SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${CONFIG.SHEET_NAME};
        const response = await fetch(url);
        
        if (!response.ok) throw new Error(HTTP error! status: ${response.status});
        return await response.text();
      } catch (error) {
        console.error('Błąd pobierania danych:', error);
        return null;
      }
    }

    function processCSVData(csvData) {
      const rows = csvData.split('\n').slice(1);
      const imageData = {};
      
      rows.forEach(row => {
        try {
          const columns = row.match(/(".?"|[^",\s]+)(?=\s,|\s*$)/g) || [];
          if (columns.length >= 3) {
            const id = columns[0].replace(/"/g, '').trim();
            const url = columns[2].replace(/"/g, '').trim();
            
            if (isValidUrl(url)) {
              imageData[id] = url;
            } else {
              console.warn(Nieprawidłowy URL dla ${id}: ${url});
              imageData[id] = CONFIG.FALLBACK_IMAGE;
            }
          }
        } catch (e) {
          console.error('Błąd przetwarzania wiersza:', row, e);
        }
      });
      
      return imageData;
    }

    function isValidUrl(string) {
      try {
        new URL(string);
        return true;
      } catch (_) {
        return false;
      }
    }

    function updatePageImages(imageData) {
      Object.entries(imageData).forEach(([id, url]) => {
        const elements = document.querySelectorAll([data-sheet-id="${id}"]);
        
        elements.forEach(element => {
          if (imageCache.get(id) === url && element.src !== CONFIG.FALLBACK_IMAGE) return;
          
          if (element.tagName === 'IMG') {
            element.src = url;
          } else if (element.style) {
            element.style.backgroundImage = url(${url});
          }
          
          console.log(Zaktualizowano: ${id} => ${url});
          imageCache.set(id, url);
        });
      });
    }

    async function updateImages() {
      console.log('Rozpoczęto aktualizację zdjęć...');
      const csvData = await fetchSheetData();
      if (!csvData) return;
      
      const imageData = processCSVData(csvData);
      updatePageImages(imageData);
    }

    // Inicjalizacja
    document.addEventListener('DOMContentLoaded', () => {
      updateImages();
      setInterval(updateImages, CONFIG.UPDATE_INTERVAL);
    });

    // Ręczna aktualizacja
    window.manualUpdate = updateImages;

    // Pozostałe skrypty (koszyk, animacje itp.)
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            document.querySelector(this.getAttribute('href')).scrollIntoView({
                behavior: 'smooth'
            });
        });
    });
    
    const addToCartButtons = document.querySelectorAll('.add-to-cart');
    const cartCount = document.querySelector('.cart-count');
    let count = 0;
    
    addToCartButtons.forEach(button => {
        button.addEventListener('click', () => {
            count++;
            cartCount.textContent = count;
            button.textContent = 'Dodano!';
            button.style.backgroundColor = '#2ecc71';
            
            setTimeout(() => {
                button.textContent = 'Do koszyka';
                button.style.backgroundColor = '';
            }, 2000);
        });
    });
    
    const fadeElements = document.querySelectorAll('.fade-in');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = 1;
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, { threshold: 0.1 });
    
    fadeElements.forEach(el => {
        el.style.opacity = 0;
        el.style.transform = 'translateY(20px)';
        el.style.transition = 'opacity 0.8s ease-out, transform 0.8s ease-out';
        observer.observe(el);
    });
    </script>
</body>
</html>
